<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Basketbol Modu</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #111;
      touch-action: none;
    }
    canvas {
      display: block;
      background: #111;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Ekranı boyutlandır
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    const seciliKafaId = localStorage.getItem("seciliKafa") || "1";
    const kafaImg = new Image();
    kafaImg.src = `kafa${seciliKafaId}.png`;

    const kafa = {
      x: canvas.width / 2,
      y: canvas.height / 2,
      vx: 0,
      vy: 0,
      radius: 40,
      isDragging: false,
      launched: false
    };

    let dragStart = null;

    canvas.addEventListener("pointerdown", (e) => {
      const dx = e.clientX - kafa.x;
      const dy = e.clientY - kafa.y;
      const distance = Math.sqrt(dx * dx + dy * dy);

      if (distance < kafa.radius) {
        kafa.isDragging = true;
        dragStart = { x: e.clientX, y: e.clientY };
      }
    });

    canvas.addEventListener("pointermove", (e) => {
      if (kafa.isDragging) {
        dragStart.currentX = e.clientX;
        dragStart.currentY = e.clientY;
      }
    });

    canvas.addEventListener("pointerup", (e) => {
      if (kafa.isDragging) {
        let dx = dragStart.x - e.clientX;
        let dy = dragStart.y - e.clientY;

        const maxPower = 150;
        const distance = Math.min(Math.hypot(dx, dy), maxPower);
        const angle = Math.atan2(dy, dx);

        kafa.vx = (distance * Math.cos(angle)) / 10;
        kafa.vy = (distance * Math.sin(angle)) / 10;
        kafa.launched = true;
        kafa.isDragging = false;
        dragStart = null;
      }
    });

    function update() {
      if (!kafa.isDragging) {
        kafa.vy += 0.5; // yerçekimi
        kafa.x += kafa.vx;
        kafa.y += kafa.vy;

        // Kenarlardan sekme
        if (kafa.x - kafa.radius < 0 || kafa.x + kafa.radius > canvas.width) {
          kafa.vx *= -1;
          kafa.x = Math.max(kafa.radius, Math.min(canvas.width - kafa.radius, kafa.x));
        }
        if (kafa.y - kafa.radius < 0 || kafa.y + kafa.radius > canvas.height) {
          kafa.vy *= -1;
          kafa.y = Math.max(kafa.radius, Math.min(canvas.height - kafa.radius, kafa.y));
        }
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Göstergeler (drag sırasında)
      if (kafa.isDragging && dragStart) {
        const dx = dragStart.x - dragStart.currentX;
        const dy = dragStart.y - dragStart.currentY;
        const length = Math.min(Math.hypot(dx, dy), 150);
        const angle = Math.atan2(dy, dx);

        for (let i = 0; i < 10; i++) {
          const dotX = kafa.x + Math.cos(angle) * i * 10;
          const dotY = kafa.y + Math.sin(angle) * i * 10;
          ctx.beginPath();
          ctx.arc(dotX, dotY, 3, 0, Math.PI * 2);
          ctx.fillStyle = "white";
          ctx.fill();
        }
      }

      // Kafa görseli
      ctx.drawImage(
        kafaImg,
        kafa.x - kafa.radius,
        kafa.y - kafa.radius,
        kafa.radius * 2,
        kafa.radius * 2
      );
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    loop();
  </script>
</body>
</html>
